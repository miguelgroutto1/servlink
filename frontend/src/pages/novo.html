    container.innerHTML = services.map(service => {
        // Garante que imgSrc seja uma string limpa e sem aspas extra
        const rawImg = (getUserProfileImage && typeof getUserProfileImage === 'function')
            ? (getUserProfileImage(service.provider_id) || '')
            : '';
        // remove possíveis aspas que possam quebrar o HTML e trim
        const cleanImg = String(rawImg).replace(/["']/g, '').trim();
        const imgSrc = cleanImg === '' ? DEFAULT_PROFILE_IMAGE : cleanImg;
    
        // monta o HTML com a tag <img> diretamente (sem função auto-executável)
        return `
        <div class="service-card hidden">
            <div class="service-image-container">
                <img src="${getPrimaryServiceImage(service)}" alt="${service.title || 'Serviço'}" class="service-img">
                <div class="service-badge">
                    <i class="fas fa-star"></i> ${(service.avg_rating || 0).toFixed(1)} (${service.review_count || 0})
                </div>
                <div class="service-price">R$ ${formatPriceValue(service.price)}/${getPriceTypeLabel(service.price_type)}</div>
            </div>
    
            <div class="service-info">
                <div class="service-user">
                    <img src="${imgSrc}" alt="${service.provider_name || 'Prestador'}" class="service-user-img">
                    <div class="service-user-details">
                        <h3 style="font-weight: 600; margin: 0 0 0.25rem 0; color: var(--text-color);">${service.title || 'Serviço sem título'}</h3>
                        <p style="margin: 0; color: var(--text-muted); font-size: 0.875rem;">
                            ${service.provider_name || 'Prestador'} • ${service.category_name || service.category || 'Categoria'}
                        </p>
                    </div>
                </div>
    
                <div class="service-desc">${service.description || 'Sem descrição disponível.'}</div>
    
                <div class="service-footer">
                    <div class="service-stars">${generateStars(service.avg_rating || 0)}</div>
                    <span class="service-distance">${service.location || 'Localização não informada'}</span>
                </div>
    
                <button class="service-view-profile-btn" onclick="viewService(${service.id})">Ver Perfil</button>
            </div>
        </div>
        `;
    }).join('');